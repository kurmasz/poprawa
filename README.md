# Poprawa

Poprawa (Polish for "improvement") is a Ruby library for generating progress reports from 
Excel-based gradebooks. It is designed for instructors who use mastery-based grading (or other
forms of alternative grading) and find that their LMS's gradebook doesn't meet their needs.
(Yes, I'm looking at you, Blackboard.)

In theory, you can use this code "out of the box" -- if you don't mind doing things the same way 
we do. However, rather than expecting you to conform your practices to our code, our goal is to
document this code well enough that you can customize it to conform to your preferred workflow.

* [Basic Workflow](#basic-out-of-the-box-workflow)
* [Overview of Major Components](#overview-of-the-major-components)
* Setting up your [First Course](#first-course)
* [Workbook Builder Details](#workbook-builder-details)

## Basic "Out-of-the-Box" Workflow]

This is what your high-level workflow would look like if you use our code without modifications:

1. Edit a Ruby config file (similar to [this one](demo/demo_workbook_builder_config.rb)) so that it describes the desired gradebook structure (e.g., assignment categories).
2. Obtain/prepare a `.csv` file (similar to [this one](demo/demo_student_roster.csv))containing student names and other information.
3. Run the `workbook_builder` script which uses the config and `.csv` files as input then generates an empty `.xlsx` workbook.
   * `workbook_builder demo_workbook_builder_config.rb` (The config file specifies the roster file.)
4. Enter marks in the grade workbook.
5. Periodically run the `gh_progress_report` script to generate a progress report for each student in markdown format.

We use GitHub to make the progress reports available to the students. Specifically, 
1. Students use [GitHub Classroom](https://classroom.github.com/) to create a precisely-named GitHub repository to which the instructor has write access.
2. Instructors add each student's GitHub account name to the gradebook's "info" worksheet.  
   * This is a manual process because our courses are typically 25 to 40 students. (Not big enough to need automation.)
3. The script `gh-progress_report` writes each progress report to the `README.md` file in the student's GitHub repository, 
   then pushes the changes. 
   * Because the report is written to `README.md`, students can view their report by simply visiting the web site for their GitHub page.
   * We configure GitHub Classroom to create private repositories, so the reports can only be seen by the student. 

The current version of `gh_progress_report` assumes that each GitHub repository has a name that is automatically generated by GitHub Classroom
(this is why we store the student's GitHub account name in the workbook instead of the specific repository name).  We would certainly consider adding the ability to store the repository name instead should there be interest.

The current version only supports report dissemination through GitHub.  However, if you wanted, you could simply make a hard copy of each report and pass them out in class. (There are tools that will convert markdown to Postscript, html, or pdf.) It should also be straightforward to add code to email each student his or her progress report (either as markdown, or converted into a different format) --- provided there is a email library that will work with your institution's email server.

## Overview of the Major Components

### Grading Workbook
Begin by opening this sample, populated grading workbook [demo_populated_workbook.xlsx](demo_populated_workbook.xlsx)

Look at the worksheet labeled `info`. 
* Notice that, in addition to the students' first and last names, this sheet also contains other useful information like username, section number, etc. In general, users can configure which data the info sheet contains. 
* To support this flexibility, notice that there are _two_ header rows. The first row contains nicer, longer names more suitable for using in reports.  The second row is a short, one-word name that is used internally. 

Now look at the worksheet labeled `learningObjectives`.  
* Notice that the leftmost rows are links to the info sheet.  (If you click on one of these cells, you can see the Excel formula.) Users can hide info columns that are not relevant to a given grading sheet.
* The remaining columns record grades/marks. The items on this worksheet are marked using the "empn" metric; but, each worksheet can be configured 
for a different type of mark/grade (including simply recording text).  
* Again, there are two header rows: a long, descriptive name and a short name used internally.

#### Marks

Each mark/grade can contain three components:
1. The mark/grade
2. The number of late days
3. A comment (private to the instructor)

The mark and late days are separated by a pipe (`|`) and the late days and comment are separated by a semi-colon.  For example:

`p | 4 ; almost correct, but some confusion in part 2`

The mark can be any string (except that it can't contain the pipe or semi-colon). The progress report simply prints the mark as written.
The only time the format of the mark matters is if you are using the script to calculate an overall grade.

(If you prefer, you can certainly create separate columns for late days and/or comments.  I have found that 
I have so few entries with late days or comments that these extra columns create a lot of visual clutter.
If you make heavier use of comments, a separate column would probably be better.)

### Workbook Builder

Most routines in the Poprawa library make assumptions about how the workbook is organized. Therefore, 
although it is possible to simply creating a new Excel Workbook and populate it, using `workbook_builder`
is much less error-prone.  In addition `workbook_builder` will 
* populate the info worksheet with data from a `.csv` (so you don't have to type 
your roster in by hand),
* freeze the user info columns so they are always visible when entering grades, and 
* lock the links to the user info columns in the grading worksheets so they aren't accidentally modified.

### Workbook Builder Command Line

The basic operation of `workbook_builder` is 

`workbook_builder name_of_config_file.rb`

Because accidentally overwriting a populated gradebook would be disastrous, `workbook_builder` is quite paranoid:
* It will prompt you before overwriting the output file. (Unless you are foolish/brave enough to use the `--force` flag.)
* It will copy the existing output file to `name_of_file.xlsx~` before overwriting.

There are a few other command-line options:
* `--output` will let you override the name of the output file. (Same paranoia as above applies.)
* `---merge` will let you provide additional config files. (This feature is intended primarily to facilitate testing; but, I can see it being potentially useful for making a quick one-time change to a config without having to edit or copy the "main" config file. It could also be useful for maintaining data that is common to all courses, such as the start and end dates.)
   * Values in subsequent config files overwrite existing values.
   * If a value passed to `merge` begins with `{` it is assumed to be Ruby code, not a file containing ruby code.  
   (Again, added primarily to simplify end-to-end testing.)

Three notes about the generated workbook:

1. The leftmost columns of the "grade" worksheets are links to the "info" columns. These linked columns are locked so that you 
can only modify student info from the "info" worksheet.  (If they weren't locked, you could replace the link with direct data, which 
would make the data inconsistent across worksheets.) You can manually unlock these cells, if desired.

2. The info columns and the two header rows are "frozen" so they remain in view when the worksheet is scrolled. This can also be modified in Excel, if desired.

3. Before printing the attendance sheet, go to "Page Layout" -> "Print Tiles" and set the name columns to be printed on every page. (If anybody knows how to write a script to automate this setup, please let me know.)


#### Student Data Input

Open this sample user info `.csv`: [demp/demo_student_roster.csv](demo_student_roster.csv)
* `workbook_builder` _ignores the header row_. Most data sources (e.g., LMS gradebook exports) produce 
a header row, so `workbook_builder` assumes there is one, and ignores the first row. 

Now, look at this sample workbook builder config file: [demo/demo_workbook_builder_config.csv](demo_workbook_builder_config.csv). This file begins by specifying the location of both the `.csv` file used for input and the Excel file it should generate as output (`gradebook_file` and `roster_file` respectively). Next, it describes the columns that will be created for the info sheet:

```ruby
  info_sheet_name: "info",
  info_sheet_config: [
    { lname: "Last Name" },
    { fname: "First Name" },
    { username: "Username" },
    { section: "Section" },
    { github: "GitHub" },
    { major: "Major" },
  ]
```

This syntax is a bit unusual: `info_sheet_config` is an array. Each item in the array is a `Hash` that provides the values in the two header rows. They key is the "short name" and the value is the "long name". (Compare the values in the code above to the header rows in the demo workbook.) Each `Hash` must have exactly one key/value pair.

`roster_config` uses "short names" to map the columns in the `.csv` file to the desired column in the info worksheet. In this example, the columns in the `.csv` and the info sheet happen to be in the same order, but that need not be the case.  Notice that the mapping is done using the order of the items in `roster_config` and the "short names" provided by `info_sheet_config`. _The `.csv` file's header row does not affect this mapping._ To ignore a column in the `.csv`, make the corresponding entry in `roster_config` `nil`.

(As a short-cut, if your LMS is BB Classic, simply set `roster_config: :bb_classic`.)

#### Catagories

Each category describes one worksheet in the workbook. Typically each worksheet contains a different category of marks (homework, project, learning objective, etc.)  Each category is described by:
  * `key`:         the name of the worksheet (both programmatically and as displayed on the tabs)
  * `title`:       the full name displayed in reports
  * `short_title`:  an abbreviation occasionally used in reports
  * `type`:        the "type" of grade (letter, `empn`, etc.) Used to (1) style the display in
                    reports, and (2) calculate final grades.  All entries in a given category must be the same type.
  * `hidden_info_columns`: These columns are hidden in the workbook. (You can "unhide" them later
                    using Excel if you change your mind.)

All worksheets contain links to all student info columns.  However, not all of those columns may be relevant for each worksheet type.  For example, I find it helpful to have the section number displayed on each worksheet.  However, I only need to see a student's GitHub account name when I'm grading projects. The `hidden_info_columns` instructs `workbook_builder` to hide info columns that the user doesn't want displayed.

#### Attendance 

If desired, `workbook_builder` will create an attendance sheet for you. Simply omit this 
entry if you don't want an attendance sheet.

```ruby 
  attendance: {
    first_sunday: "2023-1-8",   # The Sunday that begins the first week of class.
    last_saturday: "2023-4-29", # The Saturday that ends the last week of class.
    meeting_days: "TR",         # Days for which an attendance column should be created.
    skip_weeks: ["2023-3-5"],   # The Sunday that begins a week to skip entirely (e.g., Spring Break)
    skip_days: ["2023-1-24"],   # An individual day to skip (e.g., Memorial day)
  }
```

(Use "U" if you want an attendance column for Sunday.)

## First Course

To set up your first course using Poprawa:

1. Create a folder to contain all of your course's grading-related files. (For simplicity, I will assume all relevant files are in this one directory.)
2. Obtain a `.csv` file containing your course roster. (Hopefully your LMS or registration system can export something that will work.)
3. Make a copy of `demo_workbook_builder_config.rb` and customize it for your course.
   * Choose a name for your Excel Workbook and set `gradebook_file` accordingly.
   * Set `roster_file` to the name of the `.csv` you just obtained.
   * Set `info_sheet_config` to describe the user data you wish to maintain. (If you are using the GitHub workflow, make sure one of those entries has a short name of `github`.)
   * Set `roster_config` to map the `.csv` columns to your user data.
   * Configure your categories
   * Configure your attendance sheet (if desired).
4. Run `workload_builder name_of_your_config_file.rb`

If you are also using the GitHub workflow:
   1. Create an assignment in GitHub Classroom (let's assume it is called `progress-report`) and have all of your students accept that assignment.
   2. Create a directory and clone all of your student's `progress-report` repositories into that directory.
   3. Edit your config file and add an `output_dir` entry pointing to the directory containing the progress report repositories.
   4. Add each student's GitHub account name to the `github` user info column.

Now, enter marks in your worksheet, and periodically run `gh_progress_report.rb name_of_config_file.rb`.

## Workbook Builder Details


## Notes to Developers

Some automated tests need to push generated reports to a GitHub repo. We didn't want those
test reports pushed to this repo, because it would severely clutter the repo's commit logs.
So, each user that wants to run tests that push to GitHub must 
1. Choose/Create a separate repo to which she has write permissions
2. Place that repo in `spec/output/poprawa-github-tests` 
   * You can specify the desired directory name when cloning a repo:  `git clone repo_url poprawa-github-tests`



   --------

Bitbucket:


   relevant information like username (which I can use to deriver their email address), section number (which allows me to combine multiple sections into a single gradesheet), GitHub name (used to disseminate progress reports) and major (which I use to generate data for our accrediting body).  